webpackJsonp([1],{"1/oy":function(e,t){},"8dbg":function(e,t){},"9M+g":function(e,t){},Id91:function(e,t){},Jmt5:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("woOf"),a=n.n(s),o=n("7+uW"),i=n("fZjL"),r=n.n(i),l=n("KorX"),u=n.n(l),c={name:"animated-number",props:{number:{default:0}},data:function(){return{displayNumber:0,interval:!1}},mounted:function(){console.log("mounted animated number",this.number),this.displayNumber=this.number?this.number:0},watch:{number:function(e){console.log("watch animated number",e),clearInterval(this.interval),null===e||isNaN(e)||e==this.displayNumber||(this.interval=window.setInterval(function(){if(this.displayNumber!=e){var t=(e-this.displayNumber)/2;t=t>=0?Math.ceil(t):Math.floor(t),this.displayNumber=this.displayNumber+t}else clearInterval(this.interval),this.interval=!1}.bind(this),20))}}},d={render:function(){var e=this.$createElement;return(this._self._c||e)("span",{staticClass:"animatedNumber",class:{inprogress:this.interval}},[this._v(this._s(this.displayNumber))])},staticRenderFns:[]},m=n("VU/8")(c,d,!1,null,null,null).exports,v=n("mtWM"),h=n.n(v);o.a.filter("humanizer",function(e,t){return"sensors"==t?0==e?"○":1==e?"●":e:"togglers"==t?0==e?"PU":1==e?"UP":e:0==e?"OFF":1==e?"ON":e});var p,f,g={scan:new Audio("static/audio/scan.mp3"),ready:new Audio("static/audio/ready.mp3"),toggle:new Audio("static/audio/clear.mp3"),update:new Audio("static/audio/update.mp3"),play:function(e){this[e].currentTime=0,this[e].play()}},w=localStorage.getItem("http")||"http://192.168.0.11",b=h.a.create({baseURL:w}),E={name:"app",data:function(){return{user:"ЗЕЛЕННЫЙ КВАРТАЛ",dismissCountDown:10,showAlert:!1,tm:null,errortm:null,value:null,ws:{isOpen:!1,start:!1,error:null,message:null,disableDemo:"true"===localStorage.getItem("disableDemo")||!1,autoconnect:"true"===localStorage.getItem("autoconnect")||!1,server:localStorage.getItem("ws")||"ws://192.168.0.11:81",http:w},message:[0,0,0,0,0,0,30,25,21,255,125,0,0,0,0,0],devices:{sensors:{PIR:{value:0,status:null},DOOR:{value:0,status:null},REED:{value:0,status:null},SOUND:{value:0,status:null},LEAK:{value:0,status:null},LIGHT:{value:0,status:null},CO2:{value:0,status:null},HUMIDITY:{value:0,status:null},TEMP:{value:0,status:null}},counters:{ELECTRICITY:{value:0,status:null},WATER:{value:0,status:null}},switch:{VALVE:{value:0,status:null},ALARM:{value:0,status:null},LAMP:{value:0,status:null},SOCKET:{value:0,status:null}},togglers:{BELL:{value:0,status:null}}}}},created:function(){this.autoconnect&&this.toggleConnect(),this.ws.disableDemo||this.demo()},watch:{"ws.server":function(e){localStorage.setItem("ws",e)},"ws.http":function(e){b.setBaseURL(e),localStorage.setItem("http",e)},"ws.disableDemo":function(e){localStorage.setItem("disableDemo",e),e?(f.reset(),window.clearInterval(this.demoInt)):this.demo()},"ws.autoconnect":function(e){localStorage.setItem("autoconnect",e)},"devices.sensors.DOOR.value":function(e){console.log("sensors->device DOOR->BELL auto",e),this.sendAction("togglers","BELL",e)},"devices.sensors.LEAK.value":function(e){console.log("sensors->device LEAK->VALVE auto",e),this.sendAction("switch","VALVE",e)},"devices.sensors.REED.value":function(e){console.log("sensors->device REED->ALARM auto",e),this.sendAction("switch","ALARM",e)},message:function(e){var t=this,n=0;g.play("update"),r()(this.devices).forEach(function(s,a){r()(t.devices[s]).forEach(function(a,o){t.devices[s][a].value=e[n++]})})}},computed:{online:function(){return this.$root.online},status:function(){return this.$root.status}},beforeDestroy:function(){window.clearInterval(this.demoInt)},methods:{demo:function(){f=new u.a(b,{delayResponse:1e3}).onAny().reply(function(e){return[200,"ok"]}),this.demoData(),window.clearInterval(this.demoInt),this.demoInt=window.setInterval(this.demoData,5e3)},demoData:function(){var e=this.message.slice(0);e[Math.ceil(2*Math.random())+8]++,e[Math.floor(4*Math.random())]=Math.floor(2*Math.random()),e[Math.floor(3*Math.random())+6]=Math.ceil(100*Math.random()),this.message=e},enter:function(e){var t=e.parentElement.dataset.newvalue,n=e.parentElement.dataset.value;e.parentElement.dataset.value=t,0!=t&&1!=t&&null!=n&&(e.parentElement.dataset.dir=t>n?"up":t<n?"down":"")},leave:function(e){e.parentElement.dataset.dir=""},toggleFullScreen:function(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},sendAction:function(e,t,n){var s=this;"switch"!=e&&"togglers"!=e||null!=this.devices[e][t].status||(void 0==n?(n=0==this.devices[e][t].value?1:0,console.log("default",e,t,n)):console.log(e,t,n),this.devices[e][t].status="progress",this.devices[e][t].value=n,g.play("toggle"),b.get(this.ws.http+"/"+t+"/"+n).then(function(){s.toggleConfirm(e,t,n)}).catch(function(){s.toggleError(e,t,n)}))},down:function(e,t){console.log("down"),"sensors"==e&&(this.devices[e][t].value=!0)},up:function(e,t){console.log("up"),"sensors"==e&&(this.devices[e][t].value=!1)},toggleConfirm:function(e,t,n){console.log("toggleConfirm"),this.devices[e][t].status=null},toggleError:function(e,t,n){console.log("toggleError"),this.devices[e][t].status="error",this.devices[e][t].value=0==n?1:0,this.timeout(e,t)},timeout:function(e,t){var n=this;window.clearTimeout(this.errortm),this.errortm=window.setTimeout(function(){n.devices[e][t].status=null},500)},toggleConnect:function(){var e=this;this.ws.isOpen?(p.close(),this.ws.isOpen=!1):(p=null,(p=new WebSocket(this.ws.server)).addEventListener("open",function(t){console.log("open",t),e.ws.isOpen=!0,p.send("start")}),p.addEventListener("error",function(t){console.log("error",t),e.ws.error=t,e.ws.isOpen=!1}),p.addEventListener("close",function(t){console.log("close",t),e.ws.isOpen=!1}),p.addEventListener("message",function(t){console.log("messsage",t),e.ws.message=t.data,e.message=JSON.parse(t.data)}))},toggleRead:function(){this.ws.isOpen&&(this.ws.start=!this.ws.start,p.send(this.ws.start?"start":"stop"))}},components:{AnimatedNumber:m}},y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{class:[e.status],attrs:{id:"app"}},[n("b-navbar",{staticClass:"bd-navbar",attrs:{toggleable:"md",type:"dark"}},[n("b-nav-toggle",{attrs:{target:"nav_collapse"}}),n("b-navbar-brand",{on:{click:function(t){e.showAlert=!e.showAlert}}},[n("img",{attrs:{src:"static/bilogo.svg",height:"36",width:"76"}})]),n("b-navbar-brand",{on:{click:function(t){e.toggleFullScreen()}}},[e._v("SMART UYI")]),n("b-navbar-nav",{staticClass:"ml-5"},[n("b-nav-item",{attrs:{to:"/"}},[e._v("Панель")]),n("b-nav-item",{attrs:{to:"/"}},[e._v("Меню")])],1),n("b-navbar-nav",{staticClass:"ml-auto"},[n("b-nav-item",{directives:[{name:"b-modal",rawName:"v-b-modal.communicate",modifiers:{communicate:!0}}]},[n("span",{class:{"text-primary":e.ws.isOpen}},[e._v("Config")])]),n("b-nav-item",{attrs:{to:"/homekit"}},[e._v("HomeKit")]),n("b-nav-item",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"settings",expression:"'settings'"}],staticClass:"ml-3"},[e._v("КВ 49")])],1)],1),n("div",{staticClass:"mx-3 px-3 pt-3"},[n("b-card-group",{staticClass:"uyi",attrs:{deck:""}},[e._l(e.devices,function(t,s){return e._l(t,function(t,a){return n("b-card",{key:a,class:[s,a,t.status,1==t.value?"enabled":"",0==t.value||1==t.value?"":"numeric"],attrs:{"no-body":"",align:"center"},on:{click:function(t){e.sendAction(s,a)},mousedown:function(t){e.down(s,a)},mouseup:function(t){e.up(s,a)}}},[n("b-card-header",[e._v(e._s(a))]),n("b-card-body",{attrs:{"data-newvalue":t.value}},[n("transition",{attrs:{name:"counters"==s?"slide-fade":"switch"==s?"chuh":"blink",duration:{enter:500},mode:"out-in"},on:{leave:e.leave,enter:e.enter}},["counters"==s?n("h4",{key:t.value,staticClass:"card-title meters"},[e._v(e._s(e._f("numeric")(t.value))+" ")]):n("h4",{key:t.value,staticClass:"card-title"},[e._v(e._s(e._f("humanizer")(t.value,s)))])])],1)],1)})})],2)],1),n("b-modal",{attrs:{id:"settings",title:"BI SERVICE - ALERT","header-text-variant":"danger","no-fade":"","hide-footer":"","hide-backdrop":""}},[n("div",{staticClass:"text-center"},[n("h4",[e._v("Внимание! ")]),n("p",[e._v("Профилактические работы с 9.00 - 14:00")]),n("img",{attrs:{height:"200",src:"static/maintenace.jpg"}})])]),n("b-modal",{attrs:{id:"communicate",title:"Подключение"}},[n("b-form-group",{attrs:{label:"Server"}},[n("b-input-group",[n("b-form-input",{model:{value:e.ws.http,callback:function(t){e.$set(e.ws,"http",t)},expression:"ws.http"}}),n("b-input-group-append",{attrs:{"is-text":""}},[n("span",{staticClass:"mr-2"},[e._v("Disable Demo")]),n("b-form-checkbox",{model:{value:e.ws.disableDemo,callback:function(t){e.$set(e.ws,"disableDemo",t)},expression:"ws.disableDemo"}})],1)],1)],1),n("b-form-group",{attrs:{label:"Server"}},[n("b-input-group",[n("b-form-input",{model:{value:e.ws.server,callback:function(t){e.$set(e.ws,"server",t)},expression:"ws.server"}}),n("b-input-group-append",{attrs:{"is-text":""}},[n("span",{staticClass:"mr-2"},[e._v("Autoconnect")]),n("b-form-checkbox",{model:{value:e.ws.autoconnect,callback:function(t){e.$set(e.ws,"autoconnect",t)},expression:"ws.autoconnect"}})],1)],1)],1),e.ws.error?n("p",{staticClass:"text-danger"},[e._v(e._s(e.ws.error))]):e._e(),e.ws.message?n("p",[e._v(e._s(e.ws.message))]):e._e(),n("template",{slot:"modal-footer"},[n("b-btn",{attrs:{variant:e.ws.isOpen?"secondary":"primary"},on:{click:e.toggleConnect}},[e._v(e._s(e.ws.isOpen?"Disconnect":"Connect"))])],1)],2),n("b-alert",{staticClass:"bialert",attrs:{dismissible:"",variant:"danger",show:e.showAlert}},[e._v("BI Service "),n("a",{staticClass:"alert-link"},[e._v("с 14:00 по 18:00 ")]),e._v("будут профилактические работы")])],1)},staticRenderFns:[]};var A=n("VU/8")(E,y,!1,function(e){n("ypQa"),n("gGAl")},null,null).exports,S=n("e6fC"),C={install:function(e){Object.defineProperty(e.prototype,"$http",{value:h.a})}},_=n("/ocq"),L={inprogress:new Audio("static/audio/scan.mp3"),ready:new Audio("static/audio/ready.mp3"),clear:new Audio("static/audio/clear.mp3"),play:function(e){this[e].currentTime=0,this[e].play()}},R={name:"Scale",watch:{realValue:function(e){console.log("value",e),e>0?(this.$root.status="inprogress",this.timeout(2e3)):(window.clearTimeout(this.tmDisplay),this.$root.status="clear")},status:function(e){L.play(e)}},computed:{realValue:function(){if(this.$root.value>=0)return this.$root.value-this.$root.zero},status:function(){return this.$root.status}},data:function(){return{isReady:null,tmDisplay:null}},components:{AnimatedNumber:m},methods:{timeout:function(e){console.log("timeo",e),window.clearTimeout(this.tmDisplay),this.tmDisplay=window.setTimeout(this.clear,e)},clear:function(){console.log("cleared"),this.$root.status="ready"}}},I={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"scales p-5"},[t("div",{staticClass:"display p-5 text-right"},[t("div",{staticClass:"value pr-5",class:{"text-muted":0==this.$root.zero}},[t("AnimatedNumber",{attrs:{number:this.realValue}})],1),t("div",{staticClass:"unit"},[this._v("кг")])])])},staticRenderFns:[]};var D=n("VU/8")(R,I,!1,function(e){n("8dbg")},null,null).exports,O={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"m-5"})},staticRenderFns:[]};var M=n("VU/8")({name:"Settings",data:function(){return{hid:null}},methods:{}},O,!1,function(e){n("WSMo")},null,null).exports;o.a.use(_.a);var k=new _.a({routes:[{path:"/scale",component:D,meta:{isPublic:!0}},{path:"/settings",component:M,meta:{isPublic:!0}}],linkActiveClass:"active",onError:function(e){console.error("Router Error",e)}}),T=(n("Jmt5"),n("9M+g"),n("ViqS")),$=n.n(T);$.a.localeData().delimiters.thousands=" ",o.a.filter("date",function(e){return e?e.toLocaleString("ru",{year:"numeric",month:"short",day:"numeric"}).initCap():""}),o.a.filter("datetime",function(e){return e?e.toLocaleString("ru",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}):""}),o.a.filter("numeric",function(e){return $()(e).format("0,0")}),String.prototype.initCap=function(){return this.toLowerCase().replace("г.","").replace(/(?:^|\s)[a-zа-я]/g,function(e){return e.toUpperCase()})};n("gXvN");var N=localStorage.getItem("apiUrl")||"http://192.168.1.10",x=h.a.create({baseURL:N});new u.a(x).onGet("/putToBag").reply(200,{user:"ASEL"}).onAny("/VALVE").reply(function(e){var t=JSON.parse(e.data);return console.log("mock closeBag",t),t.count>0?[200,t]:[400,{error:"Мешок пустой!"}]}).onGet("/SOCKET").reply(200,{user:"ASEL"}).onAny().reply(function(e){return 100*Math.random()>10?[200,{PIR:0,DOOR:0,REEDSWITCH:0,HUMIDITY:"25",TEMP:"21",HALLMETER:"255",POWERMETER:1e3,WATERMETER:800,LEAK:0,LIGHT:1,SOCKET:1,CLAP:0,VALVE:1}]:[400,{error:"Отправление RB508027382SG не найдено!"}]});o.a.use(S.a),o.a.use(C),o.a.config.productionTip=!1,o.a.mixin({methods:{$resetData:function(e){console.log("reset global data =",this.$options.name),a()(this.$data,this.$options.data.call(this)),(null!==e&&e||null==e)&&this.$emit("reset",null)},$_clone:function(e){return a()({},e)},$:function(e){return document.querySelector(e)},$ArrayRemoveElement:function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}),new o.a({el:"#app",data:function(){return{status:!1,value:0}},created:function(){window.addEventListener("com",this.read)},mounted:function(){},watch:{},beforeDestroy:function(){window.removeEventListener("com",this.read)},router:k,methods:{read:function(e){isNaN(e.detail)?console.error("is not a number"):this.value=e.detail}},render:function(e){return e(A)}})},WSMo:function(e,t){},gGAl:function(e,t){},ypQa:function(e,t){},zj2Q:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.339292585ec57612d22a.js.map